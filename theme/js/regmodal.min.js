var d = new Date();
var hrs = d.getHours();
var day =d.getDate();
var month =d.getMonth()+1;

/*console.log('hrs'+hrs)
console.log('day'+day)
console.log('month'+month)
*/

if (day==31&&month==12&&(hrs < 12 || hrs <=19) )
{

miniShop2.Callbacks.Cart.add.response.success = function() {
        html = '<div id="successModal" class=" " tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true" data-keyboard="false" data-backdrop="static">',
        html += `<div class="modal-dialog">`,
        html += '<div class="modal-content white">',
        html += `<div class="modal-header text-center">`,
        html += '<div class="zakaz_message" style="text-align:center">Уважаемые пользователи, обращаем внимание<br>Сегодня, 31 декабря заказы принимаются c 12:00 до 19:00 включительно</div>'
        html += '<p class="modal-title strong" id="successModallLabel">Товар в корзине</p>', 
        html += "</div>", 
        html += '<div class="modal-body text-center pt40">', 
        html += '<button type="button" class="btn btn-yellow" data-dismiss="modal">Продолжить покупки</button> <a class="btn btn-yellow" href="/checkout" role="button">Оформить заказ</a>', 
        html += "</div>", 
        html += '<div class="modal-footer">', 
        html += "</div>",
        html += "</div>", 
        html += "</div>", 
        html += "</div>", 
        console.log('fuck'),
        $("body").append(html), 
        $("#successModal").modal(), 
        $("#successModal").modal("show"), 
        $("#dynamicModal").on("hidden.bs.modal", function(l) {
            $(this).remove()
        }), $(".jGrowl").addClass("hidden")
};
}
// if (day==25&&month==12&&hrs >=18 )
// {
// $('.zakaz_message.31_12_2').removeClass('hidden');
// $('.zakaz_message').addClass('hidden');
// }
// if (day==1&&month==1)
// {
// $('.zakaz_message.01_01').removeClass('hidden');
// $('.zakaz_message').addClass('hidden');
// }
else
if (day==31&&month==12&&hrs >=19 )
{

miniShop2.Callbacks.Cart.add.response.success = function() {
        html = '<div id="successModal" class=" " tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true" data-keyboard="false" data-backdrop="static">',
        html += `<div class="modal-dialog">`,
        html += '<div class="modal-content white">',
        html += `<div class="modal-header text-center">`,
        html += '<div class="zakaz_message" style="text-align:center">Уважаемые пользователи, на сегодня заказы больше не принимаются<br>Желаем Вам счастливого Нового Года!</div>',
        html += '<p class="modal-title strong" id="successModallLabel">Товар в корзине</p>', 
        html += "</div>", 
        html += '<div class="modal-body text-center pt40">', 
        html += '<button type="button" class="btn btn-yellow" data-dismiss="modal">Продолжить покупки</button> <a class="btn btn-yellow" href="/checkout" role="button">Оформить заказ</a>', 
        html += "</div>", 
        html += '<div class="modal-footer">', 
        html += "</div>",
        html += "</div>", 
        html += "</div>", 
        html += "</div>", 
        
        $("body").append(html), 
        $("#successModal").modal(), 
        $("#successModal").modal("show"), 
        $("#dynamicModal").on("hidden.bs.modal", function(l) {
            $(this).remove()
        }), $(".jGrowl").addClass("hidden")
};
} 

else
if (day==1&&month==1&&hrs <=17 )
{

miniShop2.Callbacks.Cart.add.response.success = function() {
        html = '<div id="successModal" class=" " tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true" data-keyboard="false" data-backdrop="static">',
        html += `<div class="modal-dialog">`,
        html += '<div class="modal-content white">',
        html += `<div class="modal-header text-center">`,
        html += '<div class="zakaz_message" style="text-align:center">Уважаемые пользователи, обращаем внимание<br>Сегодня, 1 января заказы принимаются c 17-00.</div>',
        html += '<p class="modal-title strong" id="successModallLabel">Товар в корзине</p>', 
        html += "</div>", 
        html += '<div class="modal-body text-center pt40">', 
        html += '<button type="button" class="btn btn-yellow" data-dismiss="modal">Продолжить покупки</button> <a class="btn btn-yellow" href="/checkout" role="button">Оформить заказ</a>', 
        html += "</div>", 
        html += '<div class="modal-footer">', 
        html += "</div>",
        html += "</div>", 
        html += "</div>", 
        html += "</div>", 
        
        $("body").append(html), 
        $("#successModal").modal(), 
        $("#successModal").modal("show"), 
        $("#dynamicModal").on("hidden.bs.modal", function(l) {
            $(this).remove()
        }), $(".jGrowl").addClass("hidden")
};
} 
else
if (((day!=31&&month!=12)||(day!=1&&month!=1))&&(hrs < 10 || hrs >=23))
{

/*miniShop2.Callbacks.Cart.add.response.success = function() {
        html = '<div id="successModal" class=" " tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true" data-keyboard="false" data-backdrop="static">',
        html += `<div class="modal-dialog">`,
        html += '<div class="modal-content white">',
        html += `<div class="modal-header text-center">`,
        html += '<div class="zakaz_message" style="text-align:center">Обращаем ваше внимание что заказы принимаются<br> с 12-00 до 23-00</div>',
        html += '<p class="modal-title strong" id="successModallLabel">Товар в корзине</p>', 
        html += "</div>", 
        html += '<div class="modal-body text-center pt40">', 
        html += '<button type="button" class="btn btn-yellow" data-dismiss="modal">Продолжить покупки</button> <a class="btn btn-yellow" href="/checkout" role="button">Оформить заказ</a>', 
        html += "</div>", 
        html += '<div class="modal-footer">', 
        html += "</div>",
        html += "</div>", 
        html += "</div>", 
        html += "</div>", 
        
        $("body").append(html), 
        $("#successModal").modal(), 
        $("#successModal").modal("show"), 
        $("#dynamicModal").on("hidden.bs.modal", function(l) {
            $(this).remove()
        }), $(".jGrowl").addClass("hidden")
};*/
}
else
{
/*miniShop2.Callbacks.Cart.add.response.success = function() {
        html = '<div id="successModal" class=" " tabindex="-1" role="dialog" aria-labelledby="confirm-modal" aria-hidden="true" data-keyboard="false" data-backdrop="static">',
        html += `<div class="modal-dialog">`,
        html += '<div class="modal-content white">',
        html += `<div class="modal-header text-center">`,
        html += '<p class="modal-title strong" id="successModallLabel">Товар в корзине</p>', 
        html += "</div>", 
        html += '<div class="modal-body text-center pt40">', 
        html += '<button type="button" class="btn btn-yellow" data-dismiss="modal">Продолжить покупки</button> <a class="btn btn-yellow" href="/checkout" role="button">Оформить заказ</a>', 
        html += "</div>", 
        html += '<div class="modal-footer">', 
        html += "</div>",
        html += "</div>", 
        html += "</div>", 
        html += "</div>", 
        $("body").append(html), 
        $("#successModal").modal(), 
        $("#successModal").modal("show"), 
        $("#dynamicModal").on("hidden.bs.modal", function(l) {
            $(this).remove()
        }), $(".jGrowl").addClass("hidden")
};*/

}


let modal = document.querySelector('div.modal');
let dish_price;

let adress = window.location.href;
if( !adress.includes('index') && !adress.includes('contacts') && !adress.includes('busket') && !adress.includes('checkout') && !adress.includes('delivery') ){

let modal_btn_plus = modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.btn_plus');
modal_btn_plus.onclick = function(event){
    if(+modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent < 30){
    modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent = parseInt(modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent) + 1;
    modal.querySelector('.modal_row > .price > span.money_amount').textContent = parseInt(modal.querySelector('.modal_row > .price > span.money_amount').textContent.split(' ').join('')) + +dish_price + ' руб';
    }else return 
}
let modal_btn_minus = modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.btn_minus');
modal_btn_minus.onclick = function(event){
    if(+modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent > 1){
    modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent = parseInt(modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent) - 1;
    modal.querySelector('.modal_row > .price > span.money_amount').textContent = parseInt(modal.querySelector('.modal_row > .price > span.money_amount').textContent.split(' ').join('')) - dish_price + ' руб' ;
    }else return 
}

let radio_set_value = {size : undefined,price : undefined,elem : undefined};
async function set_value_radio(){
         let radio_btns = document.querySelectorAll('input[name="options[mid]"]');
         for(let i = 0; i < radio_btns.length; i++){
            radio_btns[i].onchange = function(event){
                if( event.target.nextSibling.textContent.split(' ').length === 6 ){event.target.value =`${event.target.nextSibling.textContent.split(' ')[3]}${event.target.nextSibling.textContent.split(' ')[4]}`}
                else{event.target.value = event.target.nextSibling.textContent.split(' ')[3];}
                radio_set_value.size= `${event.target.nextSibling.textContent.split(' ')[0]}${event.target.nextSibling.textContent.split(' ')[1]}`;
                radio_set_value.price = parseInt(event.target.value)
                radio_set_value.elem = event.target;
            }
         }
}
if( document.querySelector('div#pdopage h2').textContent === 'ПИЦЦА' ){
set_value_radio();
}


 


let order_btns = document.querySelectorAll('span.button');
let dark_bg = document.querySelector('div.dark_bg');
let close_btn = modal.querySelector('div.close_btn');
function appr_modal(){
    dark_bg.style.opacity = 1;
    dark_bg.style.zIndex = 10000;
    modal.style.opacity = 1;
    modal.style.zIndex = 10001;
    modal.style.top = window.innerHeight/2 - modal.offsetHeight/2 + 'px';
    modal.style.left = window.innerWidth/2 - modal.offsetWidth/2 + 'px';
}
window.addEventListener("resize", ()=>{modal.style.top = window.innerHeight/2 - modal.offsetHeight/2 + 'px';modal.style.left = window.innerWidth/2 - modal.offsetWidth/2 + 'px';});
function hide_modal(){
    dark_bg.style.opacity = 0;
    dark_bg.style.zIndex = -10000;
    modal.style.opacity = 0;
    modal.style.zIndex = -10001;
}
dark_bg.onclick = function(){
    hide_modal();
}
close_btn.onclick = function(){
    hide_modal();
}

for( let i = 0; i < order_btns.length;i++ ){
order_btns[i].onclick = function(event){
    //alert( event.target.closest('div.good-block').querySelector('div.prices span.price').textContent );
    modal.querySelector('.modal > .modal_row > div.img').style.background = `url("${event.target.closest('div.good-block').querySelector('div.image > img').src}")`;
     if( document.querySelector('div#pdopage h2').textContent !== 'ПИЦЦА' ){
    appr_modal();
    modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent = 1;
    modal.querySelector('.modal_row > .dish_inf > span.dish_name').textContent =  event.target.closest('div.good-block').querySelector('p.title').textContent;
    dish_price = parseInt(event.target.closest('div.good-block').querySelector('div.prices span.price').textContent.split(' ').join(''));
    modal.querySelector('.modal_row > .price > span.money_amount').textContent =  dish_price + ' руб';
    modal.querySelector('.modal_row > .price > span.one').textContent = dish_price + ' руб';
     } else{
        if( event.target.closest('div.good-block').querySelectorAll('div.section input:checked').length == 0 ){
            let pghrs =  event.target.closest('div.good-block').querySelectorAll('div.section p');
            pghrs.forEach(elem => {
                elem.style.textDecoration = 'underline red';
            });
            setTimeout(()=>{ pghrs.forEach(elem=>{elem.style.textDecoration = 'none'}) },1500)
        }
        else{
            appr_modal();
            modal.querySelector('.modal_row > .dish_inf > .dish_numb > span.numb').textContent = 1;
            modal.querySelector('.modal_row > .dish_inf > span.dish_name').textContent =  event.target.closest('div.good-block').querySelector('p.title').textContent + ` (${radio_set_value.size})`;
            dish_price = parseInt(radio_set_value.price);
            modal.querySelector('.modal_row > .price > span.money_amount').textContent =  dish_price + ' руб';
            modal.querySelector('.modal_row > .price > span.one').textContent = dish_price + ' руб';
        }
     }
}
}




let btn_to_busket = modal.querySelector('span.btn_to_busket');
let busket_alert = document.querySelector('nav[class="navbar navbar-custom"]').querySelector('div.busket_alert');
let busket_push = document.querySelector('nav[class="navbar navbar-custom"] div.cart span.push_icon');
btn_to_busket.onclick = function(event){
    hide_modal();
    busket_alert.style.opacity = 1;
    setTimeout(()=>{busket_alert.style.opacity = 0;},2500);
    busket_push.style.opacity = 1;
    busket_push.style.animationPlayState = 'running';
}

}